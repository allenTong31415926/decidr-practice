<script>
  document.addEventListener('turbo:load', function() {
    window.sortTable = function(columnIndex) {
      const table = document.querySelector('table');
      if (!table) return;

      const tbody = table.querySelector('tbody');
      if (!tbody) return;

      const th = table.querySelectorAll('th')[columnIndex];
      if (!th || !th.classList.contains('sortable')) return;

      const rows = Array.from(tbody.querySelectorAll('tr'));

      const currentDir = th.getAttribute('data-sort-dir') || 'asc';
      const newDir = currentDir === 'asc' ? 'desc' : 'asc';

      table.querySelectorAll('th').forEach(header => {
        header.removeAttribute('data-sort-dir');
      });

      th.setAttribute('data-sort-dir', newDir);

      rows.sort((a, b) => {
        const aValue = a.children[columnIndex]?.textContent?.trim() || '';
        const bValue = b.children[columnIndex]?.textContent?.trim() || '';

        if (newDir === 'asc') {
          return aValue.localeCompare(bValue);
        } else {
          return bValue.localeCompare(aValue);
        }
      });

      tbody.innerHTML = '';
      rows.forEach(row => tbody.appendChild(row));
    }

    window.toggleUploadButton = function() {
      const fileInput = document.querySelector('input[type="file"]');
      const uploadButton = document.getElementById('upload_button');
      if (uploadButton) {
        uploadButton.disabled = !fileInput.files.length;
      }
    }

    toggleUploadButton();
  });
</script> 